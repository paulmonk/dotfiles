# mutt.org/doc/manual/
# This is the general mutt config which has the settings that all accounts use.

# Paths
# -----------
set mailcap_path     = "${XDG_CONFIG_HOME}/mutt/etc/mailcap"

# Basic
# -----------
set help                                             # show the help lines
set forward_format   = "Fwd: %s"
set mail_check       = 0                             # How often (in seconds) mutt should look for new mail.
set sleep_time       = 0                             # Disable pause when disaplying info or moving folders
set timeout          = 5                             # How many seconds at most to wait until it aborts waiting for input
unset use_domain                                     # Qualify all local addresses (ones without the “@host” portion) with the value of $hostname
unset user_agent                                     # Indicates which version of mutt was used for composing the message.
unset wait_key                                       # Wait for a key only if the external command returned a non-zero status.

# Colours
# -----------
source ${XDG_CONFIG_HOME}/mutt/etc/muttcol

# Composing
# -----------
set askcc                                            # Prompt for (Cc) recipients before editing the body of an outgoing message.
set edit_headers                                     # Edit the header of your outgoing messages along with the body of your message.
set text_flowed                                      # Generate “format=flowed” bodies with a content type of “text/plain; format=flowed”

# Index View
# -----------
set date_format      = "%Y-%m-%d %H:%M"
set index_format     = "%2C %Z %D %-15.15F %s (%4c)"
set sort             = threads
set sort_aux         = reverse-last-date-received    # How threads are sorted in relation to other threads
unset mark_old                                       # Don't mark unread new msgs as old
set tilde                                            # Fill out messages with '~'.
set mime_forward                                     # Attached fwd as a separate message/RFC822 MIME part instead of included in the main body.

# Pager View
# -----------
unset markers                                        # If set, a “+” marker is displayed at the beginning of wrapped lines.
set pager_index_lines     = 10                       # Determines the number of lines of a mini-index which is shown when in the pager.
set pager_context         = 3                        # No of lines of context that are given when displaying the next or previous pageset
set pager_stop                                       # No auto move at end of message


# Alternatives
# -----------
auto_view text/html
auto_view text/calendar application/ics
alternative_order text/plain text/enriched text/html

# Crypt / PGP
# -----------
set crypt_autosign                                  # Auto signing of all messages.
set crypt_use_gpgme                                 # use the GPGME-enabled crypto backends
set crypt_replysign                                 # when you answer a signed message, the response will be signed too.
set crypt_replyencrypt                              # when you answer an encrypted message, the response will be encrypted too.
set crypt_replysignencrypted                        # sign replies to messages which are encrypted
set crypt_verify_sig                                # Auto verify the signed message

# VI remappings
# -----------
source ${XDG_CONFIG_HOME}/mutt/etc/vim-keys

# General remappings
# -----------
bind editor <space> noop
bind index,pager i noop
bind index \Cf noop

bind index D delete-message
bind index U undelete-message
bind index F search
bind index,pager R group-reply
macro index,pager S '<sync-mailbox>

# Sidebar
# -----------
set mail_check_stats
set sidebar_visible
set sidebar_width          = 30
set sidebar_short_path
set sidebar_next_new_wrap
set sidebar_format         = "%B%?F? [%F]?%* %?N?%N/? %?S?%S?"
bind index,pager \Ck sidebar-prev
bind index,pager \Cj sidebar-next
bind index,pager \Co sidebar-open
bind index,pager <F3> sidebar-page-up
bind index,pager <F4> sidebar-page-down
bind index,pager \Cp sidebar-prev-new
bind index,pager \Cn sidebar-next-new
bind index,pager B sidebar-toggle-visible

# Urlscan
# -----------
macro index,pager \cu "<pipe-message> urlscan<Enter>" "call urlscan to extract URLs out of a message"
macro attach,compose \cu "<pipe-entry> urlscan<Enter>" "call urlscan to extract URLs out of a message"

# Khard Integration
# -----------
set query_command="khard email --parsable %s"
bind editor <Tab> complete-query
bind editor ^T    complete
bind index,pager c noop
macro index,pager ca "<pipe-message>khard add-email<return>" "add the sender email address to khard"
macro index,pager cs "<shell-escape>vdirsyncer sync fastmail_contacts<return>" "sync contacts"

# Notmuch searching
# -----------
macro index \Cf "<enter-command>unset wait_key<enter><shell-escape>read -p 'notmuch query: ' x; echo \$x >${XDG_CACHE_HOME}/mutt/terms<enter><limit>~i \"\`notmuch search --output=messages \$(cat ${XDG_CACHE_HOME}/mutt/terms) | head -n 600 | perl -le '@a=<>;chomp@a;s/\^id:// for@a;$,=\"|\";print@a'\`\"<enter>" "show only messages matching a notmuch pattern"
macro index A "<limit>all\n" "show all messages (undo limit)"

# Accounts
# -----------
# Shortcuts
macro index,pager i1 '<sync-mailbox><enter-command>source ${XDG_CONFIG_HOME}/mutt/accounts/gmail/muttrc<enter><change-folder>!<enter>'
macro index,pager i2 '<sync-mailbox><enter-command>source ${XDG_CONFIG_HOME}/mutt/accounts/fastmail/muttrc<enter><change-folder>!<enter>'

# Source Primary Account
source ${XDG_CONFIG_HOME}/mutt/accounts/fastmail/muttrc

#  vim: set ft=muttrc ts=2 sw=2 tw=80 et :
