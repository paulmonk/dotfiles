# Keep the .worktrees/ convention used across all repos.
worktree-path = "{{ repo_path }}/.worktrees/{{ branch | sanitize }}"

# LLM-generated commit messages using Claude via conventional commits.
[commit.generation]
command = "MAX_THINKING_TOKENS=0 claude -p --model=haiku --tools='' --disable-slash-commands --setting-sources='' --system-prompt=''"
template = """
Write a commit message for the staged changes below.

<format>
- Use Conventional Commits: <type>(<scope>): <description>
- Types: feat, fix, refactor, docs, test, chore
- Subject: lowercase after type, present tense, 50 chars or less
- For material changes, add a blank line then a body paragraph
  explaining the why (not the what), wrapped at 72 characters
- Output only the commit message, no quotes or code blocks
</format>

<style>
- Imperative mood: "add feature" not "added feature"
- Match recent commit style if available
</style>

<diffstat>
{{ git_diff_stat }}
</diffstat>

<diff>
{{ git_diff }}
</diff>

<context>
Branch: {{ branch }}
{% if recent_commits %}<recent_commits>
{% for commit in recent_commits %}- {{ commit }}
{% endfor %}</recent_commits>{% endif %}
</context>
"""
squash-template = """
Combine these commits into a single commit message.

<format>
- Use Conventional Commits: <type>(<scope>): <description>
- Types: feat, fix, refactor, docs, test, chore
- Subject: lowercase after type, present tense, 50 chars or less
- For material changes, add a blank line then a body paragraph
  explaining the why (not the what), wrapped at 72 characters
- Output only the commit message, no quotes or code blocks
</format>

<style>
- Imperative mood: "add feature" not "added feature"
- Match the style of commits being squashed
</style>

<commits branch="{{ branch }}" target="{{ target_branch }}">
{% for commit in commits %}- {{ commit }}
{% endfor %}</commits>

<diffstat>
{{ git_diff_stat }}
</diffstat>

<diff>
{{ git_diff }}
</diff>
"""

[post-create]
prek = '''
[ -f .pre-commit-config.yaml ] || exit 0
if HOOKS_PATH=$(git config --get core.hooksPath 2>/dev/null) && [ -n "$HOOKS_PATH" ]; then
  mkdir -p "$HOOKS_PATH"
  [ -e "$HOOKS_PATH/pre-commit.old" ] || ln -s ~/.config/worktrunk/hooks/pre-commit.old "$HOOKS_PATH/pre-commit.old"
else
  prek install
fi
'''
python-uv = "[ -f pyproject.toml ] && [ -f uv.lock ] && uv venv --clear && uv sync || true"

# Copy gitignored files (node_modules, target/, .next/, etc.) from the main
# worktree using copy-on-write. Scoped by .worktreeinclude when present.
[post-start]
copy = "wt step copy-ignored"
