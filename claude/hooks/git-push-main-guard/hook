#!/usr/bin/env bash
#/ Blocks direct pushes to main or master branches.
#/
#/ Forces use of feature branches and PRs instead of pushing
#/ directly to the default branch.
set -o errexit -o errtrace -o pipefail -o nounset

# shellcheck source=claude/lib/hook-io.sh
source "${HOME}/.claude/lib/hook-io.sh"

main() {
  local input command
  input=$(read_hook_input)

  command=$(echo "${input}" | jq -r '.tool_input.command // ""')

  # Match git push targeting main or master as the branch/refspec.
  if echo "${command}" | grep -qE 'git[[:space:]]+push[[:space:]].*(main|master)(\s|$|:)'; then
    deny_tool 'Use a feature branch and PR instead of pushing directly to main/master.'
    exit 0
  fi

  echo "${input}"
}

main "$@"
